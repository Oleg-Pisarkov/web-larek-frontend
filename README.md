# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

* Интерфейс товара

```
  interface IItem {
  id: string; - id товара
  description: string; - описание товара
  image: string; - изображение товара
  title: string; - заголовок товара
  category: keyof typeof itemCategory; - категория товара
  price: number | null; - цена товара
  } 
```

* Интерфейс описывающий заказ

```
  interface IOrder  {
  payment: string; - тип оплаты
  address: string; - адрес доставки
  phone: string; - номер телефона
  email: string; - адрес почты
  total: number; - цена покупки
  items: string[]; покупаемые товары
  }
```

* Интерфейс описывающий состояние всего приложения

```
  interface IAppState {
  basketItems: IItem[]; - товары в корзине
  catalogItems: IItem[]; - каталог товаров
  orderForm: OrderForm; - форма заказа
  contactForm: IContactForm; - форма контактов 
  }
```

* Интерфейс успешной покупки

```
  interface IOrderResult {
  id: string; - id купленного товара
  total: number; - цена купленного товара
  }
```

* Интерфейс корзины

```
  interface IBasketModal {
  list: HTMLElement[]; - товары
  total: number; - общая цена 
  }
```

* Интерфейс модального окна заказа товара

```
  interface IOrderForm {
  paymentType: string; - тип оплаты
  address: string; - адрес доставки
  }
```

* Интерфейс модального окна контактов
```
  interface IContactForm {
  phone: string; - номер телефона
  email: string; - адрес почты
  }
```

* Все категории товаров 
```
  const itemCategory = {
  'софт-скил': {title: 'софт-скил', value: 'soft'},
  'хард-скил': {title: 'хард-скил', value: 'hard'},
  'другое': {title: 'другое', value: 'other'},
  'дополнительное': {title: 'дополнительное', value: 'additional'},
  'кнопка': {title: 'кнопка', value: 'button'},
  }
```

* Интерфейс контейнера с товарами
```
  interface IItemContainer {
	catalog: HTMLElement[]; - каталог товаров
  }
```

* Интерфейс товара в корзине
```
  interface IItemBasket extends IItem {
  id: string; - id товара
  index: string; - индекс товара в корзине
  }
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.


### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие  


### Слой данных

#### Класс AppState
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстатн брокера событий.\
В полях класса хранятся следующие данные:
- `private _basketItems: IItem[] = [];` - массив товаров в корзине
- `private _catalogItems: IItem[] = [];` - массив товаров на странице
- `private _orderForm: OrderForm = { address: '', paymentType: '' };` - поля модального окна оформления заказа
- `private _contactForm: IContactForm = { email: '', phone: '' };` - поля модального окна контактов 

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `set catalogItems(items: IItem[])` - добавляет полученный товар в каталог товаров
- `get catalogItems(): IItem[]` - возвращает каталог товаров
- `set orderForm(form: OrderForm)` - добавляет данные для полей оформления заказа
- `get orderForm(): OrderForm` - возвращает  данные для полей оформления заказа
- `set contactForm(form: IContactForm)` - добавляет данные для полей контактов
- `get contactForm(): IContactForm` - возвращает  данные для полей контактов
- `get basketItems(): IItem[]` - возвращает массив товаров в корзине 
- `get basketTotal(): number` - возвращает общую стоимость товаров в корзине 
- `getCatalogItemById(id: string): IItem | undefined` - возвращает товар с нужным id из массива товаров 
- `addBasketItem(item: IItem): void` - добавляет товар в корзину
- `removeBasketItem(id: string): `void` - удаляет товар из корзины
- `clearBasket(): void` - очищает корзину
- `resetForms(): void` - обновляет форму
- `validateOrderForm(): IForm` - валидация формы заказа
- `validateContactForm(): IForm` - валидация формы контактов 

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  

Поля класса
- `events: IEvents` - брокер событий
- `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна

#### Класс ItemModal
Расширяет класс Modal. Предназначен для реализации модального окна просмотра товара. При открытии модального окна получает объект с данными, которые нужно показать. Добавляет обработчик, который передается для выполнения при клике на кнопку добавления товара в корзину.\
Поля класса:
- `content: HTMLElement` - контент модального окна
- `description: HTMLElement` - описание товара
- `image: HTMLImageElement` - изображение товара
- `title: HTMLElement` - заголовок товара
- `category: HTMLElement` - категория товара
- `price: HTMLSpanElement` - цена товара
- `closeButtonElement: HTMLButtonElement` - кнопка закрытия модального окна
- `basketButton: HTMLButtonElement` - кнопка добавления в корзину
- `_id: string` - id товара

Методы:
- `disabledButton()` - отключает кнопку добавления в корзину если товар уже есть в корзине 
- `set modalItem` - устанавливает данные в разметку
- `set ItemId` - устанавливает id
- `set itemCategory` - устанавливает категорию товара 

#### Класс BasketModal
Расширяет класс Modal. Предназначен для реализации модального окна корзины. При открытии модального окна добавляет обработчик, который передается для выполнения при клике на кнопку оформления товара.\
Поля класса:
- `_list: HTMLUListElement` - список товаров в корзине
- `_total: HTMLSpanElement` - общая стоимость товаров в корзине
- `basketButtonBuy: HTMLButtonElement` - кнопка "оформить" заказ

Методы:
- `set basketItems(items: HTMLElement[])` - добавляет товары в корзину , если корзина пуста создает сообщение "Корзина пуста"
- `disabledButton()` - отключает кнопку "оформить" заказ , если в корзине нет товаров
- `changeIndex()` - устанавливает индекс на товары в корзине

#### Класс Success
Расширяет класс Modal. Предназначен для реализации модального окна успешной покупки. При открытии модального окна добавляет обработчик, который передается для закрытия окна.\
Поля класса:
- `_description: HTMLParagraphElement` - элемент модального окна, где указана стоимость покупки
- `successButton: HTMLButtonElement` - кнопка "За новыми покупками!"

Методы:
- `set total(total: number)` - устанавливает в _description стоимость покупки

#### Класс Form
Расширяет класс Modal. Предназначен для реализации модальных окон с формой.\
Поля класса:
- `_submitButton: HTMLButtonElement` - кнопка модального окна
- `_errors: HTMLElement` - элемент модального окна для отображения ошибок формы

Методы:
- `set valid(value: boolean)` - делает кнопку _submitButton не активной если форма не валидная 
- `set errors(value: string)` - устанавливает текст для ошибок валидации

#### Класс Order
Расширяет класс Form. Предназначен для реализации модального окна заказа. При открытии модального окна добавляет обработчик, который передается для выполнения при клике на кнопку оформления товара.
Добавляется слушатели на кнопки _card и _cash , при нажатии на одну из них вторая становится не активна и передает данные в метод onInputChange для отслеживания способа оплаты.
Так же добавляется слушатель на _address для получения данных, которые пользователь ввел в инпут.\
Поля класса:
- `_card: HTMLButtonElement` - кнопка оплаты "Онлайн"
- `_cash: HTMLButtonElement` - кнопка оплаты "При получении"
- `_address: HTMLInputElement` - инпут для размещения адреса доставки

Методы:
- `disableButtons()` - делает кнопки _card и _cash не активными 
- `set address(value: string)` - устанавливает адрес
- `reset()` - сбрасывает значения поля адрес и делает кнопки _card и _cash не активными 

#### Класс Contacts
Расширяет класс Form. Предназначен для реализации модального окна контактов. При самбите инициирует событие покупки.
При изменении данных  в полях ввода инициирует событие изменения данных\
Поля класса:
- `_phone: HTMLInputElement` - инпут для указания номера телефона
- `_email: HTMLInputElement` - инпут для указания почты

Методы:
- `reset()` - сбрасывает значения поля _phone и  _email
- `onInputChangeContacts(field: keyof IContactForm, value: string)` - возвращает объект с данными из полей формы.

#### Класс Item
Отвечает за отображение карточки, задавая в карточке данные: описания, изображения, названия, категории, цены, id. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает `actions.onClick` для инициации событий.\
Методы:
- `set _idd(id: string)` - устанавливает id товара
- `get _idd()` - возвращает id товара
- `set itemCategory(value: keyof typeof itemCategory)` - устанавливает категорию товара
- `render(itemData: Partial<IItem> | undefined)` - расширяет родительский метод, обрабатывает данные заполняя атрибуты элементы карточки данными. 

#### Класс BasketItem
Отвечает за отображение товара в корзине, задавая в карточке данные: индекс, название, цену. В классе устанавливаются слушатели на кнопку удаления товара.\

Методы:
- `set title(title: string)` - устанавливает название товара
- `set price(price: string)` - устанавливает цену товара
- `set index(index: string)` - устанавливает индекс товара


#### Класс ItemContainer
Отвечает за отображение блока с товарами на главной странице. В конструктор принимает контейнер, в котором размещаются товары. В методе set catalog(items: HTMLElement[]) принимает массив товаров, который добавляет в контейнер.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `items:loded` - загрузка товаров с сервера
- `catalogItems:set` - изменение массива товаров
- `basketItems:add` - добавление товара в корзину
- `basketItems:delete` - удаление товара из корзины
- `basketItems:changed` - обнуление корзины
- `order:success` - отправка данных покупки на сервер

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие модального окна с корзиной
- `item:open` - открытие модального окна просмотра товара
- `order:open` - открытие модального окна с формой доставки 
- `orderInput:change` - изменение данных в форме с данными доставки
- `order:submit` - открытие модального окна с контактами 
- `contactsInput:change` - изменение данных в форме с данными контактов
- `contacts:submit` - отправка данных на сервер
- `order:success` - открытие модального окна успешной покупки, обновление счетчика товаров в корзине, обновление форм адреса и контактов, очистка корзины
- `success:close` - закрытие модального окна успешной покупки




